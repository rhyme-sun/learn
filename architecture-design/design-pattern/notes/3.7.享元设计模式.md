# 享元设计模式

“享元”，顾名思义就是被共享的单元。享元模式的意图是复用对象，节省内存，前提是享元对象是不可变对象。

具体来讲，当一个系统中存在大量重复对象的时候，如果这些重复的对象是不可变对象，我们就可以利用享元模式将对象设计成享元，在内存中只保留一份实例，供多处代码引用。

这样可以减少内存中对象的数量，起到节省内存的目的。实际上，不仅仅相同对象可以设计成享元，对于相似对象，我们也可以将这些对象中相同的部分（字段）提取出来，设计成享元，让这些大量相似对象引用这些享元。

## 享元跟单例、缓存、对象池的区别

享元模式跟单例的区别

一个类只能创建一个对象，而在享元模式中，一个类可以创建多个对象，每个对象被多处代码引用共享。



享元模式跟缓存的区别

享元模式"缓存"对象是为了共享使用，节省空间，而缓存一般是为了提升访问效率，而非复用。



享元模式跟对象池的区别

池化技术中的“复用”可以理解为“重复使用”，主要目的是**节省时间**（比如从数据库池中取一个连接，不需要重新创建）。在任意时刻，每一个对象、连接、线程，并不会被多处使用，而是被一个使用者独占，当使用完成之后，放回到池中，再由其他使用者重复利用。而且这类对象的创建成本往往较高，使用使用池化技术可以避免频繁销毁和创建，从而达到了节省时间的目的。

享元模式中的“复用”可以理解为“共享使用”，在整个生命周期中，都是被所有使用者共享的，主要目的是**节省空间**。

## 示例

享元模式在 JDK Integer、String 中的应用。

Integer 会将对象的值在 -128 到 127 之间进行缓存，不会重复创建。具体体现在 `Integer#valueOf` 方法：

```java
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

> 可以设置 VM Options 修改被缓存值的范围：`-XX:AutoBoxCacheMax=255` 或 `-Djava.lang.Integer.IntegerCache.high=255`  



String 类利用享元模式来复用相同的字符串常量。JVM 会专门开辟一块存储区来存储字符串常量，这块存储区叫作“字符串常量池”。