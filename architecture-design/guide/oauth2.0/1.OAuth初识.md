# OAuth2.0 初识

## 认识 OAuth2.0

[理解OAuth 2.0 - 阮一峰的网络日志 (ruanyifeng.com)](https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)

## 使用场景

有两种场景下我们会考虑 OAuth 2.0。

- 第一种场景，也是 OAuth2.0的核心场景，就是**提供开放接口（Open API）**。

  对于一个服务提供方来说，通过推广自己的 App ，来让更多用户使用自己的服务是一个常规的办法。但还有一个非常值得考虑的方式，就是把服务以 API 方式开放出来，让更多的 App 接入自己的服务。一旦我们希望授权第三方应用程序来调用我们的服务，最好的选择是 OAuth 2.0。

- 第二种场景，是**作为 OpenID 提供方**。

  也就是说，第三方应用接入我的 OAuth 接口，并不是为了要调用我的什么能力，而只是为了复用我的用户。

  这当然不是谁都能够做得到的，还是要有足够大的用户基数，并且有一定的入口价值才有可能被接受。国内被广泛使用的典型 OpenID 提供方有：微信和 QQ、支付宝、新浪微博等。

  为了支持 OAuth 2.0 作为 OpenID 的场景，OpenID Foundation 还专门引入了 OpenID Connect 协议规范。详细资料如下：[OpenID Connect | OpenID](https://openid.net/connect/)

### 提供开放接口

提供开放接口是 OAuth2.0 的核心使用场景，它涉及到以下三个角色：

- **服务提供商**，包括授权服务（Authorization Server）和资源服务（Resource Server）；
- **终端用户**，也就是资源拥有方（Resource Owner），终端用户是服务提供商的用户，它的资源也存在于服务提供商提供的服务中，但是这些资源的归属是属于终端用户的，所以我们称之为资源拥有方；
- **第三方应用**，也就是客户端（Client），在 OAuth 的视角中，官方应用和第三方应用并无大的区别，以相同的机制在工作，从这一点来说，称之为客户端会更加合理。

提供开发接口对于服务提供商来讲，系统的一些能力不在局限于自己的应用使用，而是开放出去，将服务能力放大；对于第三方应用来讲，OAuth 2.0 提供了一个很好的方式，能够让第三方应用使用 API 来访问服务来获取终端用户的资源，且不用暴露终端用户隐私（比如用户名和密码）。

这三个角色交互的基本场景是：

- 首先，第三方应用，也就是客户端（Client），向服务提供商提出接入申请，这一步可以理解为类似把 App 注册到应用商店的过程，每个应用只需要做一次；

- 然后，客户端（Client）向终端用户，也就是资源拥有方（Resource Owner）申请访问权限，这个申请发生在服务提供商提供的环境中，所以服务提供商可以感知资源拥有方是拒绝，还是接受了客户端的请求；
- 然后，客户端（Client）向服务提供商的授权服务（Authorization Server）发起授权请求，并得到了可用于访问资源的 Token；
- 最后，客户端（Client）通过 Token 向服务提供商的资源服务（Resource Server）发起资源访问请求。

## JWT

Auth 2.0 本身只关心授权，所以它会返回访问令牌（Access Token）和更新令牌（Refresh Token）。但无论是访问令牌还是更新令牌，都并没有包含身份（Identity）信息。没有身份信息，就没法作为 OpenID Provider。

身份令牌（ID Token）解决了这一问题。ID Token 是一个 JSON Web Token (JWT) ，支持你对 Token 进行解码（decode）并验证（verify）用户身份。关于 JSON Web Token 的详细介绍，请参阅 https://jwt.io/ 。