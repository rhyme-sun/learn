# 活字格公式



## Excel 常见错误

[Excel 常见的 8 种错误类型如何解决？这篇 1500 字文章带你详细解读 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/77626922)

Excel 操作过程中的错误收集。

### `#DIV/0!`

除数为 0。

### `#VALUE!`

主要表现为不同数据类型的值进行运算时就会出现。比如当文本类型和数值类型的值相加的时候，就会出现 `#VALUE!` 的错误类型。这个时候我们需要核对检查一下数据区域中的值是否为相同的格式类型。

除此之外，在 Excel 中，`#VALUE!` 表示**键入公式的方式错误，或者引用的单元格错误**。这种错误非常普遍，并且很难找到具体原因。

[如何更正 #VALUE! 错误 (microsoft.com)](https://support.microsoft.com/zh-cn/office/如何更正-value-错误-15e1b616-fbf2-4147-9c0b-0a11a20e409e)

### `#N/A`

错误类型 `#N/A` 出现的原因主要为在进行函数运算的时候，我们对应的值不存在的时候，就会出现这样的错误值。当我们用 `VLOOKUP` 函数查询某个人的数据，但是原始数据没有这个人的时候，就会出现这样的错误。

解决方法：利用函数查询不存在的人员数据的时候，这个时候就会出现 `#N/A` 的错误。这个时候我们需要用 `IFERROR` 函数来进行替换，当出现不存在的数据时，我们可以自动返回不存在的备注。

函数公式：`=IFERROR(VLOOKUP(F5,B:D,3,0),"不存在")`

### `#NUM!`

错误值 `#NUM!` 的出现主要是由于公式中出现了超出 Excel 限定的数值计算范围的时候，就会出现这样的错误。如我们需要计算 3 的 10307 次方的时候：=3^10307，这样的结果数字因为超出了最大的计算范围，所以就会出现错误 `#NUM!`。

### `#REF!`

错误类型 `#REF!` 出现的原因主要为，当在通过函数引用某一个单元格或者单元格区域时，当引用的区域被删除后，这样函数就无法找到需要引用的区域，所以就会导致这样的错误。如我们利用 SUM 函数对原来的 D3:D6 单元格区域进行求和，当我们将 D 列数据删掉后，那么 SUM 函数就无法引用对应的区域，最终就会出现错误。

### `#NAME?`

`#NAME?`错误类型主要表现有四种错误样式：

1. 函数公式输入错误，如 SUM 变成了 SNM；
2. 单元格引用区域错误；
3. 数值类型错误不符合计算规则；
4. 文本字符引用时未规范使用英文双引号。

### `####`

错误类型 `####` 主要代表的是当前单元格宽度满足不了数值的长度。所以会出现显示不全的情况。

解决方法：如上图所示当入职日期长度过长的时候，单元格就会显示为许多 # 的形式。这里我们只要调整单元格列宽就可以解决。

###  `#NULL!`

`\#NULL!` 错误数据类型主要存在于函数在引用单元格区域的时候，单元格区域范围出现错误。如我们需要根据每款产品销量和单价计算总金额。因为单元格函数区域的问题就会出现错误。具体区别如下面的函数所示：

正确函数：`=SUMPRODUCT(C3:C7,D3:D7)`

错误函数：`=SUMPRODUCT(C3:C7 D3:D7)`



## Excel 公式

公式的基本使用

[公式的基本使用 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355464)

[活字格支持 Excel 函数列表 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355602)

常用的 Excel 函数：

| 函数                                                         |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [SUM 函数](https://support.office.com/client/sum-函数-043e1c7d-7726-4e80-8f32-07b23e057f89) | 此函数用于对单元格中的值求和。                               |
| [IF 函数](https://support.office.com/client/if-函数-69aed7c9-4e8a-4755-a9bc-aa8bbff73be2) | 此函数用于在条件为真时返回一个值，条件为假时返回另一个值。   |
| [LOOKUP 函数](https://support.office.com/client/lookup-函数-446d94af-663b-451d-8251-369d5e3864cb) | 需要查询一行或一列并查找另一行或列中的相同位置的值时，请使用此函数。 |
| [VLOOKUP 函数](https://support.office.com/client/vlookup-函数-0bbc8083-26fe-4963-8ab8-93a18ad188a1) | 如果需要按行查找表或区域中的内容，请使用此函数。例如，按员工号查找某位员工的姓氏，或通过查找员工的姓氏查找该员工的电话号码（就像使用电话簿）。 |
| [MATCH 函数](https://support.office.com/client/match-函数-e8dffd45-c762-47d6-bf89-533f4a37673a) | 此函数用于在单元格区域中搜索某项，然后返回该项在单元格区域中的相对位置。例如，如果区域 A1:A3 包含值 5、7 和 38，则公式 =MATCH(7,A1:A3,0) 返回数字 2，因为 7 是该区域中的第二项。 |
| [CHOOSE 函数](https://support.office.com/client/choose-函数-fc5c184f-cb62-4ec7-a46e-38653b98f5bc) | 此函数用于根据索引号从最多 254 个数值中选择一个。例如，如果 value1 到 value7 表示一周的 7 天，那么将 1 到 7 之间的数字用作 index_num 时，CHOOSE 将返回其中的某一天。 |
| [DATE 函数](https://support.office.com/client/date-函数-e36c0c8c-4104-49da-ab83-82328b832349) | 此函数用于返回代表特定日期的连续序列号。 此函数在公式，而非单元格引用提供年、月和日的情况中非常有用。 例如，可能有一个工作表所包含的日期使用了 Excel 无法识别的格式（如 YYYYMMDD）。[DATEDIF](https://support.office.com/client/datedif-bd549d1c-f829-4691-a77d-4a1e3d42bc1a) 函数用于计算两个日期之间的天数、月数或年数。 |
| [DAYS 函数](https://support.office.com/client/days-函数-57740535-d549-4395-8728-0f07bff0b9df) | 此函数用于返回两个日期之间的天数。                           |
| [FIND、FINDB 函数](https://support.office.com/client/find、findb-函数-c7912941-af2a-4bdf-a553-d0d89b0a0628) | 函数 FIND 和 FINDB 用于在第二个文本串中定位第一个文本串。这两个函数返回第一个文本串的起始位置的值，该值从第二个文本串的第一个字符算起。 |
| [INDEX 函数](https://support.office.com/client/index-函数-a5dcf0dd-996d-40a4-a822-b56b061328bd) | 此函数用于返回表格或区域中的值或值的引用。                   |



### TEXTJOIN

TEXTJOIN 函数将多个区域和/或字符串的文本组合起来，并包括你在要组合的各文本值之间指定的分隔符。 如果分隔符是空的文本字符串，则此函数将有效连接这些区域。

类似于 Java 中的 `String#join` 函数，将字符串数组转换为用指定分割符串联的字符串。

### MOD

区域函数。

[MOD 函数的使用方法 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/435343778)











### 引用格式

活字格支持两种 Excel 公式引用单元格的方式：A1 样式和名称样式。

A1 样式即用字母代表列、用数字代表行，比如 A1 就表示第 1 行，第 A 列。默认情况下，活字格使用 A1 样式引用单元格。

使用名称可使公式更加容易理解和维护，您可以为单元格或单元格区域定义名称。使用名称管理器可轻松地更新、审核和管理这些名称。为单元格名称或单元格区域定义名称与 Excel 操作相同。



> 绝对引用和相对引用
>
> [Excel 中的相对引用与绝对引用 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/119316022)

### 名称公式

名称即你可以给单元格命名。

给单元格定义名称后，可直接用单元格的名称来进行运算，使公式更加直观，易理解。

可为单元格区域、函数、常量或表格定义名称，在名称管理器中可轻松地管理这些名称。给一个单元格或者单元格区域定义名称后，在公式中直接使用名字指代引用的单元格或者单元格区域。



创建名称和 Excel 中的操作类似，有两种方法：

- 使用名称管理器创建。

- 在名称框中直接输入名称并按 Enter 键提交。

具体见：[名称公式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355510)



> 设计器中单元格的名称在前段页面元素中的体现。
>
> 设计器中的单元格会对应页面元素，单元格名称会作为页面元素的 fgcname 属性。 TODO... 待确认
>
> [如何用代码获取页面所有已经命名好的单元格的名称？ - 活字格专区 - 求助中心 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/showtopic-81114-1-1.html)

### 公式单元格引用方式

[使用方式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355544)

在活字格中应用公式时有以下几种引用方式：

- 单元格应用单元格

  在一个单元格中使用公式，可以通过 A1 样式或名称样式对其他单元格的值进行引用。

- 单元格引用模板行中的单元格

  在页面单元格中使用公式时，可以引用表格模板行的单元格，此时引用的其实是表格的一列单元格。

  **模板行其实对应表格中的一列单元格**。

  比如可以在普通单元格中利用聚合 Excel 函数统计某列数据的数量，也可以在模板行中的单元格中引用普通单元格的值，并且对整列数据都生效。

- 表格模板行内单元格相互引用

  在表格的模板行的单元格中使用公式，可引用模板行中的单元格，此时会在表格的整列应用这个公式，且会按行对应，两两计算。

  例如，计算订单详情表中每种物品的金额，需要使用其单价乘以数量，具体见下面操作。

- 表格与表格之间，模板行单元格相互引用

  在实际的生产环境中，经常需要添加一些辅助表格以帮助用户获得所需数据，这时的公式就是应用在表格中，并引用了其他表格模板行中的单元格。

  例如，在订单系统中，订单详情表为订单表的子表，在订单详情表中有订单的总金额字段，可通过公式获取到订单详情表中的总金额字段，将其显示在订单表中。具体见下面操作。

### 数组公式

[数组公式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355574)

活字格中支持使用数组公式，数组公式只能在单元格中使用，表格中不支持数组公式。

数组公式是指可以在数组的一项或多项上执行多个计算的公式。您可以将数组视为一行值、一列值或行值和列值的组合。数组公式可以返回多个结果，也可返回一个结果。

包括多个单元格的数组公式称为多单元格公式，位于单个单元格中的数组公式称为单个单元格公式。

使用数组公式可以执行更多复杂的计算，例如：

- 计算包含在某个单元格区域中的字符数。
- 仅对满足特定条件的数字求和，例如某一区域中的最小值或介于上限和下限之间的数字。
- 对一系列值中的每第 *n* 个值求和。

数组公式通常又称作 CSE (Ctrl+Shift+Enter) 公式，因为不是只按 Enter 键，而是要按 Ctrl+Shift+Enter 完成公式。



举个例子：

使用一般公式计算单元格乘积累计和 `=SUM(C2*D2,C3*D3,C4*D4,C5*D5,C6*D6,C7*D7,C8*D8,C9*D9,C10*D10,C11*D11)` ；

使用数组公式后可简化为：`{=SUM(C2:C11*D2:D11)}` 

> 注意：使用数组公式必须按 **Ctrl+Shift+Enter** 提交公式。执行此操作后，数组公式将被大括号括起来。如果您手动输入大括号，公式将转换为文本字符串，不起作用。



数组公式使用场景：

- 多个单元格和单个单元格例子可以看：[数组公式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355574)

- 数组公式只能应用在单元格中，但数组公式可引用表格模板行中的单元格。具体例子可看：[数组公式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355574)

- 数组公式中使用 OData 函数展示表中的数据

  通常情况下，在活字格中使用表格展示表中的数据。但如果您想使用的函数的参数不支持引用表格中的单元格，那么您就需要在普通单元格中展示表中的数据。在这种情况下，您就可以通过在数组公式中使用 OData 函数来实现。

  具体例子可看：[数组公式 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72355574)

- 



数组公式的理解

在保持多个单元格数据相对位置信息的情况下进行公式运算。

## OData

在活字格中使用 OData 函数，通过设置查询参数、条件等，在数据库中进行数据查询，将一个或一组数据返回到页面中。OData 还可以与其他 Excel 函数和操作符组合使用，使得在页面上可以方便的获取到数据库的数据。







> 关联联动的四种实现方式
>
> [帮你打开活字格更神奇的功能：十九，关联联动效果，自动带出对应数据 - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=45893)
>
> [看完必恍然大悟的活字格内幕：五，OData和VLOOKUP的抉择问题 - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=38177&highlight=odata)



