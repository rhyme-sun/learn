# 活字格命令

在活字格中，命令是非常重要的功能，它用来执行业务，比如单击一个按钮进行页面跳转、弹出或是提交数据到数据库。

在命令窗口可新建多条命令，这些命令会按顺序依次执行。也可以对命令进行删除、上移、下移、插入、复制、禁用操作。

## 页面加载时命令和单元格命令

单元格命令用着单元格状态改变时触发，页面加载命令则在页面每次加载后触发。页面加载命令可以看做是对单元格命令的补充。

具体例子可看：[页面加载时命令和普通命令混淆 - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=38127&extra=page%3D3)

## 页面跳转命令

跳转页面、弹出页面



值传递与值回传。

在页面跳转命令和弹出页面命令可以在高级设计将源页面的值传递给目标页面。值回传是指从目标页面返回到源页面后，再将传递的值返回到源页面。

在关闭弹出页面有值回传选项，勾选了这个选项后，将弹出页面命令中传递的值，回传到源页面（这个功能在处理页面交互逻辑上很有用）。



关闭弹窗命令除了值回传选项外，还有下面两个选项：

- 父页面重新加载绑定数据：勾选此选项后，关闭弹出页面后，弹出页面的查询条件将传递到父页面，父页面重新加载数据。

- 传递查询结果到父页面：勾选此选项后，关闭弹出页面后，弹出页面的查询条件将传递到父页面，父页面重新加载数据。

  [传递查询结果到父页面 - 活字格 V8 帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72353932)

  这个选项用在弹出的页面是查询类页面的场景下，例子可以上面帮助手册里的内容。

## 单元格命令

单元格命令。

### 单元格命令触发时机

文本框：失去焦点，并且内容文本框内输入内容发生变化时会触发命令。其他键盘输入框单元格类似，比如数字输入框。

单选按钮：选择项发生变化时触发（即每选择点击一次，就触发一次）。

多选按钮：选择项目改变时触发。

组合复选框：每个选项被选择或取消选择时触发。

链接：每次点击时触发。

组合框：每个项目被选中时触发。

日期：日期值选择值改变后触发。

图片：点击图片后触发。

按钮：按钮点击时触发。

背景图片：点击背景图片区域后触发命令。

### 操作单元格命令

[操作单元格命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72368079)

不同的单元格类型有不同的操作。使用操作单元格命令，当您选择一个目标单元格类型时，该单元格可用的操作会被列出，您可以查看此目标单元格支持的操作，并根据您的实际业务需要来选择使用的操作。

利用操作单元格命令可以在一个命令序列中将页面上其他单元格的命令逻辑组合起来。

### 设置单元格属性

[单元格命令-设置单元格属性 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354393)

**场景：**动态控制页面元素样式（比如动态控制页面元素是否可见）。

**限制：**图片上传、附件、数据导航按钮、分页导航按钮、流程条、登录用户和条形码这些单元格类型不支持设置命令。

单元格属性包括：

- 值：给单元格设置固定的值，可直接输入。
- 可见/不可见：设置单元格是否显示。
- 启用/禁用：设置是否禁用单元格。
- 只读/读写：设置单元格为只读或读写。
- 背景色：给单元格设置背景颜色，可直接输入十六进制颜色码或选择特定的颜色。
- 前景色：给单元格设置前景色，可直接输入十六进制颜色码或选择特定的颜色。

属性的值可直接输入，或单击图标选择一个单元格或单元格区域。也可以选择值，单元格属性设置不同，可选择的值不同。

### 设置单元格位置

[活字格7.0新功能解密：十二，流式布局（六）移动单元格命令 - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=86767&highlight=%D2%C6%B6%AF%B5%A5%D4%AA%B8%F1)

//TODO...





## 表格相关命令

表格相关命令。

### 表格数据传递命令（插件）

[表格数据传递命令 - 葡萄城市场 (grapecity.com.cn)](https://marketplace.grapecity.com.cn/ApplicationDetails?productID=SP2104280010&productDetailID=D2206270027&tabName=Tabs_detail)

**场景：**将一个表格的数据传递到另外一个表格，可跨页面。

**传递目标列可以使用列名称**，这样可实现做一次设置即可实现从一个子页面（弹出页面）向不同父页面的表格传递数据，只要父页面有对应名称的列。



### 设置当前行命令（插件）

[设置当前行命令 - 葡萄城市场 (grapecity.com.cn)](https://marketplace.grapecity.com.cn/ApplicationDetails?productID=SP2104280011&productDetailID=D2206270035&tabName=Tabs_detail)

设置当前行命令可以让表格中满足某条件的行变为当前行。

场景：动态修改数据表的当前行信息。

### 列选项命令

场景：用户自定义选要表格中要展示的信息，用在表格字段比较多的场景。

使用列选项命令，要给表格字段命名。

[列选项命令 - 活字格 V8 帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354479)

### Excel 命令

#### 导出页面表格到 Excel

这里导出的内容为页面表格里的内容（更加具体来讲导出的是页面表格加载的数据，不一定是页面上能看到的数据），使用导出表格到 Excel 命令，可将页面中的表格导出到 Excel，表格外的其他数据不会被导出。

导出内容：

- 页面上的公式字段可以设置为只导出公式值而不用导出公式；
- 设置了分页导航按钮后，导出时也会导出表格中有的全部数据；
- 按需加载会影响导出数据数量：
  - 如果表格设置了加载记录行数，而没有启用按需加载。此时，表格只能显示加载记录行数的部分数据，也就只能导出显示的这些数据；
  - 如果表格设置了加载记录行数，并且启用按需加载。此时表格可以显示所有数据，导出时可以导出所有数据。
- 列选项命令会影响到表格导出的列。
- 表格查询条件会影响导出，即会根据表格的查询条件过滤，导出满足条件的。
- 列头筛选查询会影响导出内容。
- 查询命令会影响导出内容。

导出表格到 Excel 是一个页面命令，在前端运行，不能运行在服务端（服务端现在没有导出数据到 Excel 的功能，有导入导出 CSV 文件的功能）。

> csv 是文本文件，可以用记事本打开，也可以用 excel 打开；xls/xlsx 是二进制文件，只有用 excel 才能打开。

#### 导出页面到 Excel

[Excel命令-导出页面到Excel - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354174)

如果在母版页上执行“导出页面到 Excel”命令，只有在页面占位区中的子页面会被导出。

当表格中的数据行数大于表格的行数时，可以设置表格数据的导出模式。

- 自动增加表格行数：增加表格的行数以能展示所有数据。
- 增加 Sheet 个数，在多个 Sheet 中显示更多的表格数据：表格行数保持不变，超过表格可展示区域的数据依次分布在不同 Sheet 中。

> 这里表格数据行数是指表格加载数据的行数，表格行数可以简单理解为面上表格展示的数据行数。



#### 下载模板文件

[Excel命令-下载模板文件 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354183)

在下载模板文件命令中，需上传供用户下载的模板文件，**只能上传一个文件**。上传后的模板文件将显示在命令下方的区域。

下载模板文件命令上传的文件格式没有要求。



#### 导入 Excel 数据到表格

在导入 Excel 数据到表格命令中，选择要导入数据的表格，选择完表格后，会自动的将表格中模板行的单元格及对应的标题填充在模板列及模板列显示名中。

导入模式可以选择追加、合并、替换，合并和替换要设置基准列。

- 追加：将 Excel 中的数据在表格原有数据基础上追加到其后。
- 合并：将 Excel 和表格中的数据合并在一起（根据基准列判断，表格中已有的数据会进行更新，没有新增，不删除）。
- 替换：基于 Excel 的数据覆盖表格的数据（根据基准列判断，表格中已有的数据会进行更新，没有新增，删除导入文件中没有对应基准列的数据）。

设置 Excel 中对应的列名。模板列显示名必须与导入的 Excel 的列名要完全一致，否则会显示错误信息。模板列显示名支持换行输入。

Excel 中列名即标题行必须位于第一行。Excel 中的列名与页面表格中的列名要完全一致，对应关系如下图所示。

> 注意：
>
> - 对于表格中组合框，如果您选择从数据库生成项目，并且选择值字段和选择显示字段不相同，活字格将会**按照显示字段识别**。
> - 在导入的 Excel 文件中，如果单元格A和单元格 B 被合并，此时导入到表格中的单元格 A 和单元格 B 的值相同。
> - 即便表格不可编辑，Excel 的数据仍然可以被导入到表格中。
> - **Excel 导入命令必须是命令列表里的第一个命令，不能在条件命令和循环命令中使用**。
> - 只支持导入 `.xlsx` 格式文件，且对应列的数据类型需一致。

### 查询命令

[一看就会，超有用活字格技能：八十三、各种查询（查询命令，表格查询，页面加载命... - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=75241&fromuid=63496)

查询命令：页面上绑定的表格都会查询重新加载数据；

表格查询：只针对当前表格；

列头查询：只针对当前表格，进行列条件筛选。



查询条件为空会查询全部数据。



查询命令与表格查询，都可以设置表格的查询条件，筛选在表格中显示的数据。表格查询具体请参见[表格查询](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354882)。

表格查询与查询命令的区别有两点：

- 时机不同：表格查询是表格自动进行的实时查询过滤，查询命令只有在单击按钮或者超链接等时才会执行。
- 执行范围不同：当页面中有表格查询和查询命令时，执行查询命令后的结果是基于表格查询的结果进行的查询得到的，即执行查询命令时会带上表格查询的过滤条件。

## 图片命令

在活字格设计器中可以给单元格区域设置背景图片，在设计器背景图片部分右键选择图片，导航栏会出现图片设计操作界面，这里可以设置图片命令。

图片命令当图片区域被点击时触发。

这个功能有时候很有用，比如我们如果想用户在点击页面的一片区域后触发命令，就可以在这个区域设置背景图片，然后设置图片命令。



插入的图片也可以通过上述操作设置图片命令。



## 逻辑控制命令

逻辑控制命令。

### 循环命令

使用循环命令，按照一定的循环方式对一个或一组子命令循环执行。循环方式分为按指定次数循环、按表格循环以及按单元格循环。



在循环命令中，循环方式为按单元格循环时， 需要指定基准单元，循环次数是基准单元格的个数。
在子命令中，如果有公式使用了相对引用，在循环过程中，公式引用的单元格会按照基准单元格进行偏移。



[帮你打开活字格更神奇的功能：三十六，循环表格批量赋值功能 - 活字格专区 - 专题教程 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/forum.php?mod=viewthread&tid=46957&fromuid=51381)

### 条件命令

条件命令可以看做是一个组合命令，主要由**条件表达式**和**执行命令**组成。

条件表达式用来表示语句成立的判断逻辑，执行命令用来指定条件成立时要执行的操作。



## 编程扩展命令

### JavaScript 命令

[编程命令-JavaScript 命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354465)

利用 JavaScript 命令，编写 JS 代码，控制页面元素逻辑。

内置 API。

使用 [jQuery](https://jquery.com/) 操作页面元素。



编写的 JS 代码是怎么执行的。

### 执行 SQL 命令

[执行SQL命令 - 活字格 V8 帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72358449)

SQL 命令传递参数，使用“@参数名”来传递参数。[SQL 参数取数 - 活字格专区 - 求助中心 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/showtopic-135435-1-1.html)



## 设置变量命令

[设置变量 命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354611)

在活字格中，可以使用设置变量命令来设置变量，变量的值可以为值、公式，或是来自数据库。

> 因为设置变量的值可以来自数据库，所以设置变量命令一定程度上可以替代 ODATA 的使用（从库里查询数据，也可以指定过滤条件）。

**场景：**在命令序列中设置变量，然后在命令序列的后续位置的其他命令可以选择变量的值作为值的来源。

业务逻辑引擎中的变量由两部分组成，变量名，变量值，变量值可以是一个静态的值、可以是一个公式（公式的计算结果）、也可以来着数据库。



一个命令序列中设置的变量也可以通过 JavaScript 编程的方式获得，即在同一个命令序列中使用 

`ForguncyCommandHelper.getVariableValue`  和 `ForguncyCommandHelper.setVariableValue` 获取和设置。

[ForguncyCommandHelper类 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72365237)



设置变量命令变量的作用域问题？

[服务端命令中的变量作用域问题 - 活字格专区 - 求助中心 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/showtopic-98537-1-1.html)

业务逻辑引擎中的变量的作用域在命令序列中有效，这意味着不同的命令序列可以设置相同的变量。

换句话说，无论是服务端命令还是前端命令中的设置变量命令，作用域都是当前命令（当前命令序列）。可以用“设置单元格属性”命令，将命令中的变量存储在一个隐藏的单元格中（单元格可以理解为是页面的全局变量），作为设置变量的一个副本，然后在外部的 JS，通过这个格子来访问，来变相扩展变量的作用域。

## 设置行列布局命令

[设置行列布局命令 - 活字格 V8 帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354578)

使用场景：用设置行列布局命令，可以**显示或隐藏整个行或列**，以调整页面的布局。

## 模板命令

在实际应用中，用户经常会定义一些复杂的命令或命令组，并且在多处使用。活字格提供了一个名为“模板命令”的特殊命令，用于命令的重用。

一个模板命令包括一个名称，一些参数和一个命令列表，用户可以自己定义这些命令。当用户需要使用模板命令时，只需要为参数赋值，即可**实现命令的“重用”**。



[模板命令 - 活字格 V8 帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72354536)

下面使用是模板命令封装 JS 函数的示例。

[利用模板命令实现封装 JS 函数，实现前端功能复用 - 活字格专区 - 格友杂谈 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/showtopic-149052-1-5.html)

## 服务端命令

活字格中的服务端命令包括四个要素：名称、参数、命令和返回值。其中名称和命令为必要元素，参数和返回值为非必要元素。

调用服务端命令时，通过服务端命令的名称来调用，将页面端参数的值传递到服务端，服务端执行指定的命令，执行完成后将返回值到页面端。

[什么是服务端命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72357140)



无参数服务端命令

有参数服务端命令

有返回值服务端命令



TODO。。。 服务端命令相互调用（私有服务端命令） ，将一个服务端命令设置为私有，这样只有服务端命令可以调用此命令。

页面和服务端命令交互是通过 HTTP 协议的，服务端命令也可以通过 RESTful 协议进行访问，`http:://IP:PORT/ServerCommand/服务端命令名称`。

### 服务端命令的参数和返回

在页面上使用“调用服务端命令”就可以调用编写好的服务端命令，调用时主要由三个选项需要设置：

- 参数列表：如果服务端命令中设置了参数，在调用服务端命令中选择了该服务端命令后，就会自动将所有的参数列出，您可以设置参数的值为固定值或选择页面上的单元格。
- 返回码至：您可以在页面中选择一个单元格，如果调用服务端命令成功，会返回 0 到这个单元格；如果调用服务端命令失败，则会返回命令执行失败的具体错误码，如 401、500 等。
- 返回信息至：您可以在页面中选择一个单元格，如果调用服务端命令成功，则不会有返回信息；如果调用服务端命令失败，则会返回命令执行失败的具体错误信息。



数组参数（常用来批量保存数据）。

[数组类型 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72357238)

[只发送变更的数据 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72357282)



上面的提到的返回码和返回信息是默认情况下的行为，如果一个服务端命令有执行结果时，页面在调用时怎么获取呢？

可以使用返回命令返回服务端命令的执行结果和返回码。

### 服务端命令支持的命令

[服务端命令支持的命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72357483)

### 异常捕获命令

[异常捕获命令 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72358401)

### 调用存储过程

[存储过程调用 - 活字格V8帮助手册 - 葡萄城产品文档中心 (grapecity.com.cn)](https://help.grapecity.com.cn/pages/viewpage.action?pageId=72358307)

[MySQL 存储过程 | 菜鸟教程 (runoob.com)](https://www.runoob.com/w3cnote/mysql-stored-procedure.html)



> 服务端命令和页面命令？
>
> 页面命令就是在浏览器里执行的命令，而服务端命令是服务器里执行的，从效率来说，服务端命令性能是比页面命令好的。涉及到前台信息的比如跳转页面，弹出消息啊，就只能页面命令做，因为服务器根本不知道这些信息。而一些涉及后台数据的，典型的就是定时任务了，就用服务端命令来做。当然他们也有功能重合的地方，比如调用存储过程、导出**页面**到 Excel 。
>
> 其实只要明确一点，服务端命令的运行环境是活字格服务器中运行的应用，页面端命令的运行环境是前段。页面可以通过调用服务端命令这个命令来可服务端命令进行交互，实际运行会走 HTTP 协议通过接口交互。
>
> 此外服务端命令也可以直接通过 URL 路径进行访问，路径为：`http:://IP:PORT/ServerCommand/服务端命令名称`。服务端命令和页面端命令都有调用存储过程命令，但命令一个在服务端运行（通过后端代码访问），一个在前端运行（通过前端代码访问）。
>
> 原文链接：[页面命令和服务端命令的区别是什么？不太理解 - 活字格专区 - 求助中心 - 葡萄城产品技术社区 (grapecity.com.cn)](https://gcdn.grapecity.com.cn/showtopic-87616-1-1.html)
