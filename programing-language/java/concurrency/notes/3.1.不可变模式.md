# Immutability 模式

我们在讨论线程安全时提到过：线程安全指某个函数、函数库在多线程环境下执行时，能够正确处理多个线程**共享的变量**，使得程序功能正确完成。这里的处理共享变量详细来讲是对共享变量在多线程环境下镜像读写操作，如果对共享变量只有读操作，没有写操作，这时候是没有线程安全问题的。

解决并发问题，其实最简单的办法就是让共享变量只有读操作，而没有写操作，没有写操作，意味着这个对象的内部状态时不可变的。这个办法如此重要，以至于被上升到了一种解决并发问题的设计模式：不变性模式。所谓不变性，简单来讲，就是对象一旦被创建之后，状态就不再发生变化。

## 具有不可变性的类

实现一个具备不可变性的类，将一个类所有的属性都设置成 final 的，并且只允许存在只读方法，那么这个类基本上就具备不可变性了。更严格的做法是这个类本身也是 final 的，也就是不允许继承。因为子类可以覆盖父类的方法，有可能改变不可变性。

## 使用 Immutability 模式注意事项

在使用 Immutability 模式的时候，需要注意以下两点：

- 对象的所有属性都是 final 的，并不能保证不可变性；
- 不可变对象也需要正确发布。

在 Java 语言中，final 修饰的属性一旦被赋值，就不可以再修改，但是如果属性的类型是引用类型，那么这个引用对象的属性是可以被修改的。所以，**在使用 Immutability 模式的时候一定要确认保持不变性的边界在哪里，是否要求属性对象也具备不可变性**。

## 总结

以上内容总结自极客时间《Java并发编程实践》专栏：

- [28 | Immutability模式：如何利用不变性解决并发问题？ (geekbang.org)](https://time.geekbang.org/column/article/92856)