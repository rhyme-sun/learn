# 字段、属性、索引器、常量





## 字段

字段表示一种对象或类型（类与结构体）关联的变量。

字段即类型的成员即成员变量。

与对象关联的字段亦加实例字段。

静态字段，表示类型的状态。



字段声明不是语句。字段名称一定要为名词。



只读字段，readonly，初始化后就不能更改的字段。

```c#
public readonly int ID;

public Student(int id)
{
    this.ID = id;
}
```



静态构造函数

```c#
struct Color
{
    public int Red;
    public int Green;
    public int Blue;
}

class Brush
{
    public static readonly Color DefaultColor = new Color() {Red = 0, Green = 0, Blue = 0};
    
    // 等价于
    static Brush
    {
        Brush.DefaultColor = new Color(){Red = 0, Green = 0, Blue = 0};
    }
}
```



### 字段的初始值

无显式初始化时，字段获得其类型的默认值，所以字段永远都会被初始化。

实例字段的初始化时机——对象创建时；

静态字段的初始化时机——类型被加载时。

## 属性

属性是一种用于访问对象或类型的特征的成员，特征反应了状态。

属性是字段的自然扩展。

从命名上看，field 更偏向于对象在内存中的布局，property 更偏向于显示世界对象的特征。

对外：暴露数据，数据可以存储在字段里，也可以是动态计算出来的。

对内：保护字段不被非法值污染。



属性由 Get/Set 方法进化而来。



### 属性的声明

```c#
class Student
{
    private int Age;
    
    public int GetAge()
    {
        return this.age;
    }
    
    public void SetAge(int age)
    {
        this.Age = age;
    }
}


class Student
{
    private int age;
    // 属性完整声明，语法糖
    public int Age
    {
        get
        {
            return this.age;
        }
        set 
        {
            // value 为上下文关键字
            this.age = value;
        }
    }
    
    private static int amount;
    public static int Amount
    {
        get {return amount};
        set {amount = value}
    }
}

// 属性简略声明
class Student
{
    public int Age {get; set;};
}
```

> 声明属性快捷方式，propfull
>
> 

### 属性和字段的关系

一般情况下，它们都是用于表示实体的状态。

属性大多数情况下是字段的包装器。

建议：永远使用属性（而不是字段）来暴露数据，即字段永远是 private 和 protected 的。





## 索引器

```c#
class Student
{
    pirvate Dictionary<string, int> scoreDictionary = new Dictionary<string, int>();
    
    // 索引器
    public int? this(string subject)
    {
        get
        {
            if (scoreDictionary.ContainsKey(subject)) 
            {
                return this.scoreDictionary(subject);
            }
            else 
            {
                return null;
            }
        }
        
        set
        {
            if(value.HasValue == false) 
            {
                throw new Exception("Score can not be null!");
            }
            if (this.scoreDictionary.ContainsKey(subject)) 
            {
                this.scoreDictionary[subject] = value.Value;
            }
            else 
            {
                this.scoreDictionary.Add(subject, value.Value);
            }
        }
    }
}
```



## 常量

常量类型而不属于对象。

不能声明自定义类型的常量，这时候可以用静态只读字段来替代。

```c#
public double const PI = 3.14159;

// Math.PI
```



各种只读场景

- 为了提高程序的可读性和执行效率——常量；
- 为了防止对象的值被改变——只读字段；
- 向外暴露不允许修改的数据——只读属性。
- 当希望成为常量的值其类型不能被常量声明接收时（类型/自定义结构体）——静态只读字段。