# 卡特兰数

卡特兰数又称卡塔兰数，英文名 Catalan number，是组合数学中一个常出现在各种计数问题中出现的数列。其前几项为：1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, 16796, 58786, 208012, 742900, 2674440, 9694845, 35357670, 129644790, 477638700, 1767263190, 6564120420, 24466267020, 91482563640, 343059613650, 1289904147324, 4861946401452, ...

## 卡特兰数通项公式

k(0) = 1、k(1) = 1时，如果接下来的项满足：
`k(n) = k(0)*k(n-1) + k(1)*k(n-2) + ... + k(n-2)*k(1)+k(n-1)*k(0)`

或者

`k(n) = C(2n,n)-C(2n,n-1)`，C 表示组合，

或者

`k(n) = C(2n,n)/(n+1)`

就说这个表达式，满足卡特兰数，常用的是范式 1 和 2，3 几乎不会使用到。

## 括号模型

问题描述如下，一共有 n 个左括号和右括号，求括号合法的情况又少种。

如果括号的组织形式违规，那么一定存在一个最短括号前缀，使得右括号的数量比左括号的数量多一个。

这时候将最短前缀后的括号全部翻转，那么形成的括号数量为右括号 n+1，左括号 n-1，这时候括号组织形式为 `C(2n,n+1)` 这些情况种的一种。

考虑两个集合 A 和 B：

- 集合 A 表示 n 个左括号和右括号，非法组织形式构成的集合；

- 集合 B 表示有 n+1 个右括号和 n-1 个左括号所有组织形式形成的集合；

- 集合 A 和集合 B 是等实的，即集合 A 种的任意一个元素，可以找到一个映射关系和 B 种的集合元素一一对应；

  > 映射关系为：找到右括号比左括号多的最短前缀，将后面的括号全部翻转，这时候左括号的数量就为 n-1，右括号的数量为 n+1；

- 因为等势关系，B 集合中右括号组合数量数就等于 A 集合中的数量，即括号违规的情况数为 `C(2n,n+1)`，又因为括号全部组合情况为 `C(2n,n)`，因此括号合法的数量为 `C(2n,n)-C(2n,n+1)`，结果为卡特兰数的通项公式。

  > `C(2n,n+1) = C(2n,n-1)`

## 合法出入栈

有 n 个数，按照固定的顺序入栈出栈，只有栈里有元素时才能够出栈，栈的长度够用，求能够 n 个数能够合法入栈再出栈完毕的情况数有多少种。

入栈非法的情况一定是存在某个最短入栈出栈序列，出栈的次数比入栈多一次。可以看出符合括号模型，因此合法出入栈的数量符合卡特兰数通项公式。

## 二叉树组织形式

一个节点数为 n 的二叉树，一共有多少种组织形式。

- 当左子树节点有 0 个，右子树节点有 n-1 个，这时候二叉树的形式个数为 `k(0)*k(n-1)`；
- 当左子树节点有 1个，右子树节点有 n-2 个，这时候二叉树的形式个数为 `k(1)*k(n-2)`；
- ...
- 当左子树节点有 n-1个，右子树节点有 0 个，这时候二叉树的形式个数为 `k(n-1)*k(0)`；

那么总的情况数量就为：`k(n) = k(0)*k(n-1) + k(1)*k(n-2) + ... + k(n-2)*k(1)+k(n-1)*k(0)`。即其二叉树组合形式符合卡特兰数通向公式，因此我们可以使用 `k(n) = C(2n,n)-C(2n,n-1)` 去计算二叉树组织形式的数量。

## 总结

在使用卡特兰数解决相关问题是，有下面关键事项：

- 要熟知卡特兰数通项公式 1 和 2；
- 要熟知括号模型（相等的数量的左右括号，括号组织非法时一定存在一个最短前缀种右括号的数量比左括号多一个）；
- 当一个问题可以抽象为括号模型时，或能够以通项公式 1 的形式组织时，就可以使用卡特兰数第二个公式直接求解。







