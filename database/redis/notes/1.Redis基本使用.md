# Redis 基本使用

## 总览

本文介绍了 Redis 的初步使用，包括 Redis 基础数据结构，以及使用 redis-cli 操作 Redis。

本文使用 Redis 版本：6.0.9 

## 安装 Redis

本文的环境是在 Windows 10 上使用 Docker 运行 Redis。

- redis.yml（Redis docker-compose 启动文件）
    ```yml
    version: '3'
    services:
      redis: # 服务名
        image: redis:6.0.9
        container_name: sc-redis
        restart: always
        networks:
        - sc-net
        ports:
        - 6379:6379
    networks:
      sc-net:
        external: false
    ```
- 启动 Reids
  
  在 redis.yml 文件相同目录使用 powershell 执行以下命令：
    ```
    docker-compose -f redis.yml up -d
    ```
- 关闭 Redis

  在 redis.yml 文件相同目录使用 powershell 执行以下命令：
    ```
    docker-compose -f redis.yml down
    ```
- 登录 Redis 控制台
  - 在 redis.yml 文件相同目录使用 powershell 执行以下命令，进入容器终端。
    ```
    docker-compose -f redis.yml exec redis /bin/sh
    ```
    上述运行命令中的 redis 为 docker-compose 文件中的服务名。
  - 在容器终端使用以下命令登录 Redis
    ```
    redis-cli
    ```

## Redis 数据类型

### 操作 key

- **del [key ...]**
  - **作用**：删除指定的一个或多个 key。
  - **时间复杂度**：删除单个 O(1)，删除 n 个 O(N)，删除列表、集合、有序集合、哈希表 O(M)，M 为上述数据结构元素的数量。
  - **返回值**：被删除 key 的数量。

- **exists [key ...]**
  - **作用**：检查指定的一个或多个 key 是否存在。
  - **时间复杂度**：检查一个 O(1)，检查 n 个 O(N)。
  - **返回值**：返回存在 key 的数量，不存在返回 0。
  
- **expire key seconds**
  - **作用**：为 key 设置或更新（key 已经设置过过期时间）过期时间，单位秒， 过期时会被自动删除。
  - **时间复杂度**：O(1)。
  - **返回值**：设置成功返回 1，当 key 不存在返回 0。
  - **注意事项**：
    - 生存时间可以通过使用 DEL 命令来删除整个 key 来移除，或者被 SET 和 GETSET 命令覆写。
    - 如果一个命令只是修改一个带生存时间的 key 的值而不是用一个新的 key 值来代替它的话，那么生存时间不会被改变。
    - 如果使用 RENAME 对一个 key 进行改名，那么改名后的 key 的生存时间和改名前一样。
  
- **keys pattern**
  - **作用**：查找所有符合 pattern 的 key。
  - **时间复杂度**：O(N)， N 为数据库中 key 的数量。
  - **返回值**：符合给定格式的 key 列表。
  - **注意事项**：
    - KEYS 的速度非常快，但在数据量大时仍然可能造成性能问题，如果你需要从一个数据集中查找特定的 key ，最好还是用 Redis 的集合结构（set）来代替。
  
- **rename key newKey**
  - **作用**：将 key 改名为 newKey。
  - **时间复杂度**：O(1)。
  - **返回值**：改名成功时提示 OK ，失败时候返回一个错误（当 key 和 newkey 相同，或者 key 不存在时，返回一个错误）。
  - **注意事项**:
    - 当 newkey 已经存在时， RENAME 命令将覆盖旧值。

- **dbsize**
  - **作用**：返回当前数据库的 key 的数量。
  - **时间复杂度**：O(1)。
  - **返回值**：当前数据库的 key 的数量。

### String 类型

字符串是一种最基本的Redis值类型。Redis字符串是二进制安全的，这意味着一个Redis字符串能包含任意类型的数据。一个字符串类型的值最多能存储512M字节的内容。

- **set key value [EX seconds] [PX milliseconds] [NX|XX]**
  - **作用**：设置 key value。
  - **时间复杂度**：O(1)。
  - **返回值**： SET 操作成功完成时，返回 OK。如果设置了 NX 或者 XX，但因为条件没达到而造成设置操作未执行，那么返回空批量回复（nil）。
  - **注意事项**:
    - 如果 key 已经存在就用新值覆盖掉旧值，无视值的类型。
    - 对于某个原本带有生存时间（TTL）的键来说， 当 SET 命令成功在这个键上执行时， 这个键原有的 TTL 将被清除。
    - 可选参数：
      - EX seconds：设置键的过期时间为 second 秒。
      - PX milliseconds：设置键的过期时间为 millisecond 毫秒。
      - NX：只在键不存在时，才对键进行设置操作。
      - XX：只在键已经存在时，才对键进行设置操作。
  
- **mset key value [key value...]**
  - **作用**：同时设置多个 key value。
  - **时间复杂度**：O(N)，N 为要设置的 key 数量。
  - **返回值**：总是返回 OK。
  - **注意事项**:
    - MSET 是一个原子操作，所有给定 key 都会在同一时间内被设置。

- **get key**
  - **作用**：获取 key 关联的 value。
  - **时间复杂度**：O(1)。
  - **返回值**：返回 key 关联 value 的值。当 key 不存在时，返回 nil，如果 key 不是字符串类型，那么返回一个错误。

- **getset key value**
  - **作用**：给定 key 的值设为 value ，并返回 key 的旧值。
  - **时间复杂度**：O(1)。
  - **返回值**：返回给定 key 的旧值，当 key 没有旧值时，即 key 不存在时，返回 nil。

- **apend key value**
  - **作用**：如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。
  - **时间复杂度**：平摊O(1)。
  - **返回值**：追加 value 之后， value 字符串的长度。
  - **注意事项**:
    - append 时若 key 不存在就如同 set 命令一样设置 key value。
    - append 命令会为 key 预留内存以减少内存分配的次数，若该 key 不需要重复 append，直接使用 set 命令修改，避免内存的浪费。

- **incr/decr key**
  - **作用**：将 key 关联的数字 value 加一/减一。
  - **时间复杂度**：O(1)。
  - **返回值**：加一/减一后的 value 的值。
  - **注意事项**:
    - 如果 key 值不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR/DECR 操作。
    - 如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。
    - 这是一个针对字符串的操作，因为 Redis 没有专用的整数类型，所以 key 内储存的字符串被解释为十进制 64 位有符号整数来执行 INCR/DECR 操作。
    - Redis 整数共享，所以如果能够用整数来存储 value 尽量使用整数，这样可以共享整数节约内存。但注意若限制了 Redis 内存大小或启用了 LRU 的淘汰策略可能会导致整数共享失效。
    - Redis 超过 16 位的整数可能会损失精度。
  
### 列表（Lists）

Redis列表是简单的字符串列表，按照插入顺序排序。 你可以添加一个元素到列表的头部或者尾部。一个列表最多可以包含232-1个元素（4294967295，每个表超过40亿个元素）。访问列表两端的元素是非常快的，但如果你试着访问一个非常大的列表的中间元素仍然是十分慢的，因为那是一个时间复杂度为 O(N) 的操作。

- **lpush/rpush key value [value...]**
  - **作用**：将一个或多个值 value 插入到列表 key 的表头/尾。
  - **时间复杂度**：O(1)。
  - **返回值**：执行 lpush/rpush  命令后，列表的长度。

- **lpop/rpop key **
  - **作用**：移除并返回列表 key 的头/尾元素。
  - **时间复杂度**：O(1)。
  - **返回值**：列表的头/尾元素，当 key 不存在时，返回 nil 。

- **lrange key start stop**
  - **作用**：返回列表 key 中指定区间内（start<=下标<=stop）的元素，区间以偏移量 start 和 stop 指定。
  - **时间复杂度**：O(S+N)， S 为偏移量 start ， N 为指定区间内元素的数量。
  - **返回值**：一个列表，包含指定区间内（start<=下标<=stop）的元素，如果 start 比 stop 或 end 大返回 empty array，如果 stop 比 end 大返回到 end 为止的列表。
  - **注意事项**:
    - Redis 列表下标从 0 开始，0 表示列表的第一个元素，以 1 表示列表的第二个元素，你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素。
    - 超出范围的下标值不会引起错误。
    - 列表中的元素可以重复。
  
- **llen key**
  - **作用**：返回列表 key 的长度，如果 key 不存在，则 key 被解释为一个空列表，返回 0。
  - **时间复杂度**：O(1)。
  - **返回值**：列表 key 的长度。

### 集合（Sets）

Redis集合是一个无序的字符串合集。你可以以 O(1) 的时间复杂度（无论集合中有多少元素时间复杂度都为常量）完成添加，删除以及判断元素是否存在的操作。集合中的元素不能重复。一个集合最多可以包含232-1个元素（4294967295，每个集合超过40亿个元素）。

- **sadd key value [value...]**
  - **作用**：将一个或多个 member 元素加入到集合 key 当中，已经存在于集合的 member 元素将被忽略。
  - **时间复杂度**：O(N)， N 是被添加的元素的数量。
  - **返回值**：被添加到集合中的新元素的数量，不包括被忽略的元素。

- **smembers key**
  - **作用**：返回集合 key 中的所有成员。
  - **时间复杂度**：O(N)， N 为集合的基数。
  - **返回值**：集合中的所有成员。
  - **注意事项**:
    - 不存在的 key 被视为空集合。

- **srandmembers key**
  - **作用**：返回集合中的一个随机元素。
  - **时间复杂度**：O(1)。
  - **返回值**：集合中的随机元素。当 key 不存在或 key 是空集时，返回 nil。

- **spop key**
  - **作用**：移除并返回集合中的一个随机元素。
  - **时间复杂度**：O(1)。
  - **返回值**：被移除的随机元素。当 key 不存在或 key 是空集时，返回 nil。

- **scard key**
  - **作用**：返回集合 key 中元素的数量。
  - **时间复杂度**：O(1)。
  - **返回值**：集合的基数。当 key 不存在时，返回 0。

- **sdiff key [key...]**
  - **作用**：返回一个集合的全部成员，该集合是所有给定集合之间的差集，
  - **时间复杂度**：O(N)， N 是所有给定集合的成员数量之和。
  - **返回值**：一个包含差集成员的列表。
  - **注意事项**:
    - 不存在的 key 被视为空集。

- **sinter key [key...]**
  - **作用**：返回一个集合的全部成员，该集合是所有给定集合的交集。
  - **时间复杂度**：O(N * M)， N 为给定集合当中基数最小的集合， M 为给定集合的个数。
  - **返回值**：交集成员的列表。
  - **注意事项**:
    - 不存在的 key 被视为空集。

- **sunion key [key...]**
  - **作用**：返回一个集合的全部成员，该集合是所有给定集合的并集。
  - **时间复杂度**：O(N)， N 是所有给定集合的成员数量之和。
  - **返回值**：并集成员的列表。
  - **注意事项**: 
    - 不存在的 key 被视为空集。

- **srem key value [value...]**
  - **作用**：移除集合 key 中的一个或多个 member 元素，不存在的 member 元素会被忽略。
  - **时间复杂度**：O(N)， N 为给定 member 元素的数量。
  - **返回值**：被成功移除的元素的数量，不包括被忽略的元素。
 
### 有序集合（Sorted sets）

Redis有序集合和Redis集合类似，它们的差别是，每个有序集合的成员都关联着一个评分，这个评分用于把有序集合中的成员按最低分到最高分排列。

- **zadd key score member [[score member] [score member] ...]**
  - **作用**：将一个或多个 member 元素及其 score 值加入到有序集 key 当中。
  - **时间复杂度**：O(M*log(N))， N 是有序集的基数， M 为成功添加的新成员的数量。
  - **返回值**：被成功添加的新成员的数量，不包括那些被更新的、已经存在的成员。
  - **注意事项**:
    - 如果某个 member 已经是有序集的成员，那么更新这个 member 的 score 值，并通过重新插入这个 member 元素，来保证该 member 在正确的位置上。
    - score 值可以是整数值或双精度浮点数。

- **zcard key**
  - **作用**：返回集合 key 中元素的数量。
  - **时间复杂度**：O(1)。
  - **返回值**：集合的基数。当 key 不存在时，返回 0。

- **zcount key min max**
  - **作用**：返回有序集 key 中， score 值在 min 和 max 之间（min<=scoremin<=max）的成员的数量。
  - **时间复杂度**：O(log(N))， N 为有序集的基数。
  - **返回值**：score 值在 min 和 max 之间的成员的数量。

- **zrange key start stop [WITHSCORES]**
  - **作用**：返回有序集 key 中，指定区间内的成员。
  - **时间复杂度**：O(log(N)+M)， N 为有序集的基数，而 M 为结果集的基数。
  - **返回值**：指定区间内，带有 score 值(可选)的有序集成员的列表。
  - **注意事项**:
    - 集合中的成员的位置按 score 值递增来排序。
    - 具有相同 score 值的成员按字典序来排列。
    - 如果你需要成员按 score 值递减(从大到小)来排列，请使用 ZREVRANGE 命令。
    - 可以通过使用 WITHSCORES 选项，来让成员和它的 score 值一并返回。

- **zscore key value**
  - **作用**：返回有序集 key 中，成员 member 的 score 值。
  - **时间复杂度**：O(1)。
  - **返回值**：member 成员的 score 值，以字符串形式表示。

- **zrank key value**
  - **作用**：返回有序集 key 中成员 member 的排名。其中有序集成员按 score 值递增(从小到大)顺序排列。
  - **时间复杂度**：O(log(N))。
  - **返回值**：如果 member 是有序集 key 的成员，返回 member 的排名。如果 member 不是有序集 key 的成员，返回 nil 。

- **zrem key value [value...]**
  - **作用**：移除集合 key 中的一个或多个 member 元素，不存在的 member 元素会被忽略。
  - **时间复杂度**：O(N)， N 为给定 member 元素的数量。
  - **返回值**：被成功移除的元素的数量，不包括被忽略的元素。

### 哈希（Hashes）
Redis Hashes是字符串字段和字符串值之间的映射，它可以用来表示对象。

- **hset key field value**
  - **作用**：将哈希表 key 中的域 field 的值设为 value 。
  - **时间复杂度**：O(1)。
  - **返回值**：如果 field 是哈希表中的一个新建域，并且值设置成功，返回 1 。如果哈希表中域 field 已经存在且旧值已被新值覆盖，返回 0。

- **hmset key field value [[field value]...]**
  - **作用**：同时将多个 field-value (域-值)对设置到哈希表 key 中。
  - **时间复杂度**：O(N)， N 为 field-value 对的数量。
  - **返回值**：如果命令执行成功，返回 OK 。当 key 不是哈希表(hash)类型时，返回一个错误。

- **hget key field**
  - **作用**：返回哈希表 key 中给定域 field 的值。
  - **时间复杂度**：O(1)。
  - **返回值**：给定域的值。当给定域不存在或是给定 key 不存在时，返回 nil。

- **hmget key field [field...]**
  - **作用**：返回哈希表 key 中，一个或多个给定域的值。
  - **时间复杂度**：O(N)， N 为给定域的数量。
  - **返回值**：一个包含多个给定域的关联值的表，表值的排列顺序和给定域参数的请求顺序一样。

- **hgetall key**
  - **作用**：返回哈希表 key 中所有数据。
  - **时间复杂度**：O(N)， N 为哈希表的大小。
  - **返回值**：哈希表 key 中所有数据。

- **hkeys key**
  - **作用**：返回一个哈希表的所有 key。
  - **时间复杂度**：O(N)， N 为哈希表的大小。
  - **返回值**：哈希表中的所有 key。

- **hvals key**
  - **作用**：返回哈希表中所有 value。
  - **时间复杂度**：O(N)， N 为哈希表的大小。
  - **返回值**：哈希表中的所有 value。


- **hlen key**
  - **作用**：返回哈希表中 key 的数量。
  - **时间复杂度**：O(1)。
  - **返回值**：哈希表中 key 的数量。

- **hdel key field [field...]**
  - **作用**：删除哈希表 key 中的一个或多个指定域，不存在的域将被忽略。
  - **时间复杂度**：O(N)， N 为要删除的域的数量。
  - **返回值**：被成功移除的域的数量，不包括被忽略的域。

### Bitmaps 

### HyperLogLogs


### Geo

## 总结

### 参考链接

[[1] Redis 中文文档](https://wizardforcel.gitbooks.io/redis-doc/content/)

[[2] Redis 中文官网.数据类型](http://www.redis.cn/topics/data-types.html)

