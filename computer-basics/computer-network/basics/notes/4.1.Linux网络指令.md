# Linux 网络指令

这里介绍下 Linux 上常用的和网络相关的指令。

## 远程登录和传输

### ssh

`ssh` 命令用于远程登录主机，和在远程主机上执行命令。如：

- 使用当前用户远程登录主机：

  ```shell
  ssh 192.168.0.18
  ```

- 指定用户名远程登录主机：

  ```shell
  ssh 192.168.0.18 -l root
  ```

- 指定端口远程登录主机：

  ```shell
  ssh 192.168.0.18 -p 22
  ```

- 远程执行命令：

  ```shell
  ssh 192.168.0.18 date
  ```

### scp

`scp` 用来在主机间拷贝文件。如：

- 将远程主机的文件拷贝到本地：

  ```shell
  # 复制文件
  scp 192.168.0.18:/root/test1.txt /root/test2.txt
  # 复制文件，指定端口
  scp -P 10022 192.168.0.18:/root/test1.txt /root/test2.txt
  
  # 复制目录
  scp -r www.runoob.com:/home/root/others/ /home/space/music/
  ```

- 将本地主机的文件拷贝到远程：

  ```shell
  ssh /root/test1.txt 192.168.0.18:/root/test2.txt
  ```

## 网络查看配置

### ifconfig

`ifconfig` 是一个用来查看、配置、启用或禁用网络接口的工具，这个工具极为常用的。可以用这个工具来临时性的配置网卡的IP地址、掩码、广播地址或网关等。也可以把 它写入一个文件中（比如 `/etc/rc.d/rc.local`)，这样系统引导后，会读取这个文件，为网卡设置 IP 地址。如：

- 查看处于激活状态的网络接口：

  ```shell
  ifconfig
  ```

- 查看所有配置的网络接口：

  ```shell
  ifconfig -a
  ```

- 查看 `eth0` 网卡信息：

  ```shell
  ifconfig eth0
  ```

- 开启 `eth0` 网卡：

  ```shell
  ifconfig eth0 up
  ```

- 关闭 `eth0` 网卡：

  ```shell
  ifconfig eth0 down
  ```

- 给网卡 `eth0` 配置 IPv4 地址：

  ```shell
  eth0 192.168.1.56
  ```

- 给 `eth0` 网卡配置 IPv4 地址，并加上子掩码：

  ```shell
  ifconfig eth0 192.168.1.56 netmask 255.255.255.0
  ```

- 给 `eth0` 网卡配置 IPv4 地址，加上子掩码，加上广播地址：

  ```shell
  ifconfig eth0 192.168.1.56 netmask 255.255.255.0 broadcast 192.168.1.255
  ```

- 给网卡 `eth0` 添加 IPv6 地址：

  ```shell
  ifconfig eth0 add 33ffe:3240:800:1005::2/ 64
  ```

- 移除网卡 `eth0` IPv6 地址：

  ```shell
  ifconfig eth0 del 33ffe:3240:800:1005::2/ 64
  ```

- 修改网卡 `eth0` 的 MAC 地址：

  ```shell
  ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE
  ```

- 设置最大传输单元（MTU）为 1500 字节：

  ```shell
  ifconfig eth0 mtu 1500
  ```

- 开启 ARP：

  ```shell
  ifconfig eth0 arp
  ```

- 关闭 ARP：

  ```shell
  ifconfig eth0 -arp
  ```

### ip

`ip` 是 iproute2 软件包里面的一个强大的网络配置工具。常用命令如下：

- 查看 `eth0` 网卡信息：

  ```shell
  ip -s -s link ls eth0
  ```

- 查看 `eth0` 网卡协议地址：

  ```shell
  ip addr ls eth0
  ```

- 开启 `eth0` 网卡：

  ```shell
  ip link set dev eth0 up
  ```

- 关闭 `eth0` 网卡：

  ```shell
  ip link set dev eth0 down
  ```

- 改变设备传输队列的长度:

  ```shell
  ip link set dev eth0 txqueuelen 100 
  ```

- 设置最大传输单元（MTU）为 1500 字节：

  ```shell
  ip link set dev eth0 mtu 1500
  ```

- 修改网卡 `eth0 ` 的 MAC 地址：

  ```shell
  ip link set dev eth0 address 00:01:4f:00:15:f1
  ```

- 给 `eth0` 网卡配置 IPv4 地址，加上子掩码，加上广播地址：

  ```shell
  ip addr add 192.168.4.2/24 brd + dev eth1 label eth1:1
  ```

- 删除协议地址：

  ```shell
  ip addr del 192.168.4.1/24 brd + dev eth0 label eth0:1
  ```

### netstat

`netstat` 用来显示网络连接，路由表，接口状态，伪装连接，网络链路信息和组播成员组。如：

- 列出所有端口 (包括监听和未监听的)：

  ```shell
  netstat -a | more
  ```

- 列出所有 TCP 端口：

  ```shell
  netstat -at
  ```

- 列出所有 UDP 端口：

  ```shell
  netstat -au
  ```

- 显示核心路由信息：

  ```shell
  netstat -r
  ```

- 显示网络接口列表：

  ```shell
  netstat -i
  ```

- 显看已连接的 TCP 端口和进程 IP 与程序名称：

  ```shell
  netstat -tpnl
  ```

- 查看 Nginx 占用端口：

  ```shell
  netstat -tpnl | grep nginx
  ```

- 查看 3306 端口占用程序：

  ```shell
  netstat -tpnl | grep 3306
  ```

- 查看 3306 端口使用链接数：

  ```shell
  netstat -anp |grep 3306 -c
  ```

- TCP 链接统计：

  ```shell
  netstat -n | awk '/^tcp/{++S[$NF]} END {for (a in S) print a, S[a]}' 
  ```

## 交互请求

### ping

`ping` 程序使用 ICMP 协议的强制回显请求数据报以使主机或网关发送一份 ICMP 的回显应答。如：

- ping 百度

  ```shell
  ping www.baidu.com
  ```

- ping 百度，指定次数和时间间隔

  ```shell
  ping -c 5 -i 0.5 baidu.com
  ```

### telnet

telnet 远端登入，并提供终端，进行交互。如：

```shell
telnet www.baidu.com 80
```

### wget

Linux 系统中的 wget 是一个文件下载工具，可以用它从远程获取文件。如：

- 下载 Centos 境像：

  ```shell
  wget http://tel.mirrors.163.com/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-bin-DVD1.iso
  ```

- 断点下载：

  ```shell
  wget -c http://tel.mirrors.163.com/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-bin-DVD1.iso
  ```

- 指定下载目录：

  ```shell
  wget -P /home/download http://tel.mirrors.163.com/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-bin-DVD1.iso
  ```

- 下载目录中的所有文件：

  ```shell
  wget -r -np -nd http://tel.mirrors.163.com/centos/6.4/os/x86_64/
  ```

### curl

curl 是一个利用 URL 规则在命令行下工作的文件传输工具，它支持文件的上传和下载，也可以用它来访问 Web 服务器。如：

- 抓取页面内容到一个文件中：

  ```shell
  curl -o home.html  http://www.baidu.com
  ```

- 下载文件：

  ```shell
  curl -O http://blog.51yip.com/wp-content/uploads/2010/09/compare_varnish.jpg  
  ```

- 请求网站（GET）：

  ```shell
  curl www.baidu.com
  ```

curl 更多用法可参考：[curl 的用法指南 - 阮一峰的网络日志 (ruanyifeng.com)](https://www.ruanyifeng.com/blog/2019/09/curl-reference.html)

## DNS 相关

### host

`host` 命令是常用的分析域名查询工具，是一个 DNS 查找实用程序，用于查找域名的 IP 地址。 它还执行反向查找，查找与 IP 地址关联的域名。如

```shell
host www.baidu.com

www.baidu.com is an alias for www.a.shifen.com.
www.a.shifen.com has address 36.152.44.95
www.a.shifen.com has address 36.152.44.96
```

### dig

`dig` 用来查询 DNS 相关信息。如：

- 查找 baidu.com 的 A 记录：

  ```shell
  dig baidu.com A +noall +answer
  ```

- 查找 yahoo.com MX 记录的列表：

  ```shell
  dig yahoo.com MX +noall +answer
  ```

- 查找 yahoo.com 权威 DNS：

  ```shell
  dig yahoo.com NS +noall +answer
  ```

- 查询上面所有的记录：

  ```shell
  dig yahoo.com ANY +noall +answer
  ```

### nslookup

`nslookup` 是一个 DNS 查询工具，分为交互和非交互。如：

```
nslookup baidu.com

Server:         8.8.8.8
Address:        8.8.8.8#53

Non-authoritative answer:
Name:   baidu.com
Address: 123.125.114.144
Name:   baidu.com
Address: 220.181.111.85
Name:   baidu.com
Address: 220.181.111.86
```