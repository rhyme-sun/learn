# HTTP 概述

超文本传输协议（HTTP, ）是一个传输超媒体文档的**应用层**协议，起初是为了 Web 浏览器和 Web 服务器之间的通信设计的，后也可以用于其他目的。HTTP 遵循典型的客户端-服务端模型，客户端打开一个连接以发送请求，然后等待服务端响应。HTTP 是无状态的协议，这意味着服务器不会在两个请求间保留任何数据（状态）。

HTTP 协议在网络分层中位置如下所示：

![](../images/HTTP层.png)

> 图片来自：[HTTP概述 - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview)

## HTTP 发展史

- HTTP/0.9（1991）：定义了协议最核心内容，确定了客户端/服务端这种基本结构，使用域名加端口号来表示目标地址，还有换行回车作为基本的分隔符；
- HTTP/1.0（1996）： 引入了返回码，引入了 HTTP header，引入了多字符集，支持多行请求；
- HTTP/1.1（1999）：大量帮助传输效率提升的特性被加入，比如，长连接（keep-alive），分块传输（chunked），缓存控制策略，客户端告知服务端可以处理的数据类型（Accept 请求头）；
- HTTP/2.0（2015）：允许客户端选择 HTTP 协议版本（ALPN），头部压缩，多路复用（允许客户端同时在一个连接中同时传输多组请求响应的方法，存在线头阻塞），二进制报文（帧）；
- HTTP/3.0：基于 UDP 传输，多路复用（无线头阻塞）。

## HTTP 交互实体

HTTP 协议遵循了客户端和服务端模型，请求通过一个客户端发出这（里的客户端多指浏览器，也可以是一些网络爬虫），服务端在收到客户端请求后处理并返回给客户端。客户端和服务端之间可能又多个代理，它们的作用的表现各不相同，有的是网关，有的是缓存。

> 代理或代理服务器是存在于服务端和客户端之间的服务器，它用来接收客户端的请求并请求服务端，根据处理请求的方式不同又分为正向代理和反向代理：
>
> - 正向代理：代理的是客户端，代理服务器收到来自客户端的请求后，**代替**客户端请求服务端，并将来自服务端的响应返回给客户端。正向代理隐藏了真实的客户端，即服务端对真实请求的客户端是没有感知的，一些翻墙软件就是正向代理；
> - 反向代理：代理的是服务端，代理服务器收到来自客户端的请求后，通过某些规则将请求**转发**到服务端，并将来自服务端的响应返回给客户端。正向代理隐藏了真实的服务端，对于客户端来说其请求的代理服务器就是服务端，Nginx 就是性能非常好的反向代理服务器，用来做负载均衡。

综上所述，HTTP 交互实体包括客户端、服务端和多个代理。其实在一个浏览器和处理请求的服务器之间，还有路由器、交换机等许多网络设备，但由于网络分层的设计，这些在传输层和网络层的细节都被隐藏起来了，HTTP 协议位于最上方的应用层，对于底层的传输细节是不需要关心的，这也是网络分层设计带来的好处。

## HTTP 基本性质

- 易扩展：HTTP 的通信双方可以通过 HTTP 头来协商工作，HTTP 头的设计让 HTTP 扩展变得容易；
- 无状态：在同一个连接中，两个执行成功的请求间是没有联系的，使用 HTTP 头部扩展 HTTP Cookies 可以解决这个问题（把 Cookies 添加到头部中，创建一个会话让每次请求都能共享上下文的信息，达到相同的状态），但 HTTP 本质上是无状态的；
- HTTP 和连接：HTTP 并不需要底层的传输协议是面向连接的，但要求它是可靠的，所以理论上 HTTP 可以依赖任何可靠的传输层协议来发送消息，不一定是要 TCP，HTTP/3 其承载协议将从 TCP 转移到基于 UDP 的 [QUIC](https://en.wikipedia.org/wiki/QUIC) 上面来。

## HTTP 报文

HTTP 的报文有两种类型，请求报文和响应报文。

> 注：HTTP 报文（在HTTP/2之前）是语义可读的，在HTTP/2中，这些简单的消息被封装在了帧中，这使得报文不能被直接读取，但是原理仍是相同的，因此用 HTTP/1.1 格式来理解 HTTP/2 报文仍旧有效。

### 请求报文

一个请求报文的例子如下所示：

```
GET / HTTP/1.1
Host: developer.mozilla.org
Accept-Language: fr

Request Body...
```

请求由以下元素组成：

- HTTP method：经常用一个动词来表示客户端的动作行为类型，如上述的 GET 表示客户端想要从服务端获取资源；
- 资源路径：紧跟着 HTTP method 后的就是资源路径（URL），不包含协议类型（`http://`）、域名（`www.example.com`）和端口；
- HTTP 协议版本号：如上述的 HTTP/1.1；
- HTTP 请求头：上述的 Host 和 Accept-Language 就是 HTTP 请求头，其是 Key-Value 结构，冒号前表示 Key，冒号后表示 Value；
- 空行：在请求头和请求体之间有一个空行，这个是规定；
- 请求体：客户端发送给服务端的请求内容，可选。

### 响应报文

一个响应报文的例子如下所示：

```
HTTP/1.1 200 OK
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
ETag: "51142bc1-7449-479b075b2891b"
Accept-Ranges: bytes
Content-Length: 29769
Content-Type: text/html

<!DOCTYPE html... (here comes the 29769 bytes of the requested web page)
```

 响应由以下元素组成：

- HTTP 协议版本号：如上述的 HTTP/1.1；
- 响应状态码：告知客户端请求执行的状态，每个状态码都有着其代表的含义；
- 响应状态信息：告知客户端请求执行的状态码描述信息，这个信息是非权威的，可有服务端自行设置；
- HTTP 响应头：和请求头类似；
- 空行：规定响应头和响应体之间有一个空行；
- 响应体：服务端发送给客户端的响应内容，可选。

## HTTP 头

HTTP 头用来控制服务端和客户端的工作方式，是 HTTP 协议扩展性质的体系，这里罗列部分比较常见的 HTTP 头，完整的可查阅：[HTTP headers - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)。

// TODO ...

## HTTP 状态码

这里罗列比较常用的状态码，完整的可查阅：[HTTP response status codes - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

// TODO ...

## 总结

HTTP 是一个应用层协议，主要为了实现浏览器和服务器之间的通信，在整个 Web 体系有着至关重要的作用。基于 HTTP 协议交互设计到的实体有客户端、服务端和多个代理。HTTP 具有易扩展（基于 HTTP 头）、无状态、需要传输层的协议是可靠这些基本性质。

此外还介绍了 HTTP 报文的格式和常见的 HTTP 头和响应码。

### 参考链接

- [HTTP概述 - HTTP | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview)

- [HTTP协议的演化 (geekbang.org)](https://time.geekbang.org/column/article/134752)