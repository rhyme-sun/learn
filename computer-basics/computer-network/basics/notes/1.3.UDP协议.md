# UDP 协议

UDP(User Datagram Protocol)，用户数据报文协议，在传输层直接提供发送报文的能力，Datagram 是数据传输的最小单位。

## UDP 报文结构

UDP 在允许用户直接发送报文的情况下最大限度简化应用设计，其包括：

- Source Port：源端口号；
- Destination Port：目标端口号；
- Length：报文长度；
- Checksum：检查封包是否出错；
- Data octets：数据，octet 是 8 位。

## UDP 的使用场景

- 需要资源少，在网络情况比较好的内网，或者对于丢包不敏感的应用；
- 不需要一对一沟通，建立连接，而是可以广播的应用；
- 需要处理速度快，时延低，可以容忍少数丢包，但是要求即便网络拥塞，也毫不退缩，一往无前的时候，比如直播。

## TCP 和 UDP 的区别

- TCP 是面向连接的，UDP 是面向无连接的；
- TCP 提供可靠交付，无差错、不丢失、不重复、并且按序到达，UDP 不提供可靠交付，不保证不丢失，不保证按顺序到达；
- TCP 面向流进行数据传输，发送缓冲区，拆包粘包；UDP 面向数据包传输，具有消息边界，不存在拆包粘包，UDP 包有效载荷小会增加系统发送和接收开销，应该最好设置一个比较合适的数据包的包长，来进行 UDP 数据的发送（UDP 最大载荷为 1472，因此最好能每次传输接近这个数的数据量，这特别适合于视频，音频等大块数据的发送，同时，通过减少握手来保证流媒体的实时性）。
- TCP 是可以提供流量控制和拥塞控制的，既防止对端被压垮，也防止网络被压垮，UDP 则没有这种能力。

## 总结

和 TCP 一样，UDP 也是传输层的网络协议，和 TCP 不同的是，UDP 不提供面向连接的可靠的传输，也没有像 TCP 那样流量控制和拥塞控制的能力。UDP 在设计上更为精简，其对数据包在网络中的流转持乐观态度。也有适合用 UDP 作为传输层通信协议的使用场景，比如对延迟要求敏感、可以容忍少量丢包的应用。

### 参考链接

- [UDP协议：因性善而简单，难免碰到“城会玩” (geekbang.org)](https://time.geekbang.org/column/article/8924)

