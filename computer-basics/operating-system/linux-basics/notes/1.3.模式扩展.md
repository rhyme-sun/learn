# 模式扩展

Shell 接收到用户输入的命令以后，会根据空格将用户的输入，拆分成一个个词元（token），然后 Shell 会扩展词源里面的特殊字符，这种特殊字符的扩展，称为模式扩展（globbing）。

## 波浪线扩展

波浪线 `~` 会自动扩展成当前用户的家目录，如：

```bash
# 显示当前用户家目录
echo ~
# 进入当前用户的家目录
cd ~
# 进入 foo 用户的家目录
cd ~foo
# `~+`  会扩展成当前所在的目录，等同于 `pwd` 命令
echo ~+
```

## 问号扩展

`?` 字符代表文件路径里面的任意单个字符，不包括空字符。比如，`data???`  匹配所有 data 后面仅跟着三个字符的文件名，如：

文件夹下有 `a.txt` 和 `aa.txt`，执行以下命令：

```bash
ls ?.txt  # 输出 a.txt

ls ??.txt # 输出 aa.txt
```

## 星号扩展

`*` 字符代表文件路径里面任意数量的任意字符，如：

```bash
# 显示所有 txt 文件
ls *.txt
```

## 方括号扩展

`[..]` 表示匹配在方括号里面的字符。如：

```bash
# 显示 a.txt 和 b.txt
ls [ab].txt
# 显示除了 a.txt 和 b.txt 以外的文件，且该文件名只有一个字符
ls [!ab].txt
# 显示不是以字母 a 或 b 开头文件
ls [!ab]*.txt
```

## 范围匹配扩展

方括号扩展有一个简写形式 `[start-end]`，表示匹配一个连续的范围。比如，`[a-c]` 等同于 `[abc]`，`[0-9]` 匹配 `[0123456789]`。如：

```bash
# 显示 a.txt、b.txt 和 c.txt
ls [a-c].txt
```

还有一些其他常用例子：

- `[a-z]`：所有小写字母；
- `[a-zA-Z]`：所有小写字母与大写字母；
- `[a-zA-Z0-9]`：所有小写字母、大写字母与数字；
- `[abc]*`：所有以 `a`、`b`、`c` 字符之一开头的文件名；
- `program.[co]`：文件 `program.c` 与文件 `program.o`；
- `BACKUP.[0-9][0-9][0-9]`：所有以 `BACKUP.` 开头，后面是三个数字的文件名。

## 大括号扩展

大括号扩展 `{...}` 表示分别扩展成大括号里面的所有值，大括号里的值用逗号分隔（逗号附近不能有空格）。比如，`{1,2,3}` 扩展成 1 2 3。如：

```bash
# 输出 1 2 3
echo {1,2,3}

# 显示 a.txt、b.txt 和 c.txt
ls {a,b,c}.txt
```

逗号前面可以没有值，表示扩展的第一项为空，如：

```bash
# 复制 a.txt 到 a.txt.bak
cp a.txt{,.bak}
```

大括号可以嵌套，如：

```bash
# 输出 aA1b aA2b aB3b aB4b
echo a{A{1,2},B{3,4}}b
```

## 范围输出扩展

大括号扩展有一个简写形式`{start..end}`，表示扩展成一个连续序列。如：

```bash
# 输出 26 个小写字母
echo {a..z}
# 逆序输出 26 个小写字母
echo {z..a}
```

大括号扩展的常见用途为新建一系列目录：

```bash
mkdir {2007..2009}-{01..12}
```

## 变量扩展

Bash 将美元符号 `$` 开头的词元视为变量，将其扩展成变量值，如：

```bash
# 输出当前系统使用的 SHELL 程序
echo $SHELL
```

变量名除了放在美元符号后面，也可以放在 `${}` 里面，如：

```bash
echo ${SHELL}
```

`${!string*}` 或 `${!string@}` 返回所有匹配给定字符串 `string` 的变量名，如：

```bash
# 输出所有以 S 开头的变量的值
echo ${!S*}
```

## 子命令扩展

`$(...)` 可以扩展成另一个命令的运行结果，该命令的所有输出都会作为返回值，如：

```bash
# 输出当前时间
echo ${date}
```

还有另一种较老的语法，子命令放在反引号之中，也可以扩展成命令的运行结果，如：

```bash
# 输出当前时间
echo `date`
```

## 总结

模式扩展是指 Shell 会将命令行中的特殊字符转换会对应指令进行执行。模式扩展在某些场景下会带来极大的遍历性，知晓这些模式扩展时有必要的。

原文链接：[Bash 的模式扩展 - Bash 脚本教程 - 网道 (wangdoc.com)](https://wangdoc.com/bash/expansion.html)